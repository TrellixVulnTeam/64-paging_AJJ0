import { Component, ElementRef, EventEmitter, HostListener, Input, Output, NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import * as ease from 'ease-component';
import { CommonModule } from '@angular/common';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
class CounterComponent {
    /**
     * @param {?} hostElement
     */
    constructor(hostElement) {
        this.hostElement = hostElement;
        this.mode = 'onInit';
        this.from = 0;
        this.to = 0;
        this.animationTime = 4000;
        this.animationType = 'linear';
        this.showCircle = true;
        this.circleColor = '#307bbb';
        this.fontSize = 150;
        this.delay = 0;
        this.finishedText = '';
        this.finished = new EventEmitter();
        this._hold = true;
        this._percentDone = 0;
        this._holdProgress = 0;
        this._finishedCounting = false;
        this.nativeElement = /** @type {?} */ (hostElement.nativeElement);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onWindowChange($event) {
        if (this.mode !== 'viewport') {
            return;
        }
        if (this.hold && this.isElementInViewport()) {
            this.start();
        }
    }
    /**
     * @return {?}
     */
    get startTimeout() {
        return this._startTimeout;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set startTimeout(value) {
        this._startTimeout = value;
    }
    /**
     * @return {?}
     */
    get nativeElement() {
        return this._nativeElement;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set nativeElement(value) {
        this._nativeElement = value;
    }
    /**
     * @return {?}
     */
    get holdProgress() {
        return this._holdProgress;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set holdProgress(value) {
        this._holdProgress = value;
    }
    /**
     * @return {?}
     */
    get percentDone() {
        return this._percentDone;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set percentDone(value) {
        this._percentDone = value;
    }
    /**
     * @return {?}
     */
    get count() {
        return this._count;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set count(value) {
        this._count = value;
    }
    /**
     * @return {?}
     */
    get startTime() {
        return this._startTime;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set startTime(value) {
        this._startTime = value;
    }
    /**
     * @return {?}
     */
    get hold() {
        return this._hold;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set hold(value) {
        this._hold = value;
    }
    /**
     * @return {?}
     */
    get finishedCounting() {
        return this._finishedCounting;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set finishedCounting(value) {
        this._finishedCounting = value;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.init();
    }
    /**
     * @return {?}
     */
    start() {
        if (this.delay > 0) {
            this.startTimeout = window.setTimeout(() => {
                this.startAction();
            }, this.delay);
            return;
        }
        this.startAction();
    }
    /**
     * @return {?}
     */
    stop() {
        window.clearTimeout(this.startTimeout);
        this.hold = true;
    }
    /**
     * @return {?}
     */
    restart() {
        this.init();
    }
    /**
     * @return {?}
     */
    init() {
        this.hold = true;
        this.count = this.from;
        this.holdProgress = 0;
        this.startTime = undefined;
        this.percentDone = 0;
        this.finishedCounting = false;
        window.clearTimeout(this.startTimeout);
        if (typeof this.of === 'undefined') {
            this.of = this.to;
        }
        if (this.mode === 'onInit') {
            this.start();
        }
    }
    /**
     * @return {?}
     */
    getCircleStyle() {
        return {
            'clip': this.percentDone >= 0.5 ? 'rect(auto, auto, auto, auto)' : 'rect(0em, 1em, 1em, 0.5em)'
        };
    }
    /**
     * @return {?}
     */
    getBarStyle() {
        const /** @type {?} */ rotateDeg = 360 * this.percentDone;
        return {
            'transform': `rotate(${rotateDeg}deg)`,
            'border-color': this.circleColor
        };
    }
    /**
     * @return {?}
     */
    getFillStyle() {
        const /** @type {?} */ rotateDeg = this.percentDone > 0.5 ? 180 : 0;
        return {
            'display': this.percentDone <= 0.5 ? 'none' : 'block',
            'transform': `rotate(${rotateDeg}deg)`,
            'border-color': this.circleColor
        };
    }
    /**
     * @return {?}
     */
    startAction() {
        this.hold = false;
        this.requestFrame();
    }
    /**
     * @param {?} timestamp
     * @return {?}
     */
    step(timestamp) {
        if (!this.startTime) {
            this.startTime = timestamp;
        }
        let /** @type {?} */ progress = timestamp - this.startTime;
        progress += this.holdProgress;
        if (this.hold) {
            this.holdProgress = progress;
            this.startTime = undefined;
            return;
        }
        const /** @type {?} */ easeValue = ease[this.animationType](progress / this.animationTime);
        let /** @type {?} */ currentCount = Math.round(easeValue * this.to);
        if (currentCount >= this.to) {
            currentCount = this.to;
        }
        this.count = currentCount;
        this.percentDone = currentCount / this.of;
        if (progress < this.animationTime) {
            this.requestFrame();
            return;
        }
        // Finished
        this.finishedCounting = true;
        this.finished.emit();
    }
    /**
     * @return {?}
     */
    requestFrame() {
        window.requestAnimationFrame(this.step.bind(this));
    }
    /**
     * @return {?}
     */
    isElementInViewport() {
        const /** @type {?} */ rect = this.nativeElement.getBoundingClientRect();
        return (rect.top >= 0 &&
            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight));
    }
}
CounterComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-counter',
                template: `<div class="ng-counter" [style.font-size]="fontSize + 'px'" [ngClass]="{'ng-counter--with-circle' : showCircle}">
    <div class="ng-counter__text">
        <ng-template [ngIf]="!finishedCounting || !finishedText.length">
            <span class="ng-counter__prefix">
                <ng-content select="ng-counter-prefix"></ng-content>
            </span>
            <span class="ng-counter__number">{{count}}</span>
            <span class="ng-counter__suffix">
                <ng-content select="ng-counter-suffix"></ng-content>
            </span>
        </ng-template>
        <ng-template [ngIf]="finishedCounting && finishedText.length">
            <span class="ng-counter__finish_text">{{finishedText}}</span>
        </ng-template>
    </div>
    <div class="ng-counter__circle" *ngIf="showCircle" [ngStyle]="getCircleStyle()">
        <div class="ng-counter__circle__bar" [ngStyle]="getBarStyle()"></div>
        <div class="ng-counter__circle__fill" [ngStyle]="getFillStyle()"></div>
    </div>
</div>`,
                styles: [`.ng-counter{display:inline-block;position:relative;font-size:150px}.ng-counter.ng-counter--with-circle{width:1em;height:1em;box-sizing:content-box}.ng-counter.ng-counter--with-circle .ng-counter__text{align-items:center;justify-content:center;height:1em}.ng-counter__text{display:flex}.ng-counter__finish_text,.ng-counter__number,.ng-counter__prefix,.ng-counter__suffix{font-size:.3em}.ng-counter__circle{position:absolute;top:0;left:0;width:1em;height:1em;box-sizing:content-box}.ng-counter__circle__bar,.ng-counter__circle__fill{position:absolute;border:.08em solid;width:.84em;height:.84em;clip:rect(0,.5em,1em,0);border-radius:50%;box-sizing:content-box}`],
            },] },
];
/** @nocollapse */
CounterComponent.ctorParameters = () => [
    { type: ElementRef, },
];
CounterComponent.propDecorators = {
    "mode": [{ type: Input },],
    "from": [{ type: Input },],
    "to": [{ type: Input },],
    "of": [{ type: Input },],
    "animationTime": [{ type: Input },],
    "animationType": [{ type: Input },],
    "showCircle": [{ type: Input },],
    "circleColor": [{ type: Input },],
    "fontSize": [{ type: Input },],
    "delay": [{ type: Input },],
    "finishedText": [{ type: Input },],
    "finished": [{ type: Output },],
    "onWindowChange": [{ type: HostListener, args: ['window:scroll', ['$event'],] }, { type: HostListener, args: ['window:resize', ['$event'],] },],
};

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
class CounterModule {
}
CounterModule.decorators = [
    { type: NgModule, args: [{
                declarations: [
                    CounterComponent
                ],
                imports: [
                    CommonModule
                ],
                schemas: [CUSTOM_ELEMENTS_SCHEMA],
                exports: [
                    CounterComponent
                ]
            },] },
];

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

export { CounterModule, CounterComponent as Éµa };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1jaXJjbGUtY291bnRlci5qcy5tYXAiLCJzb3VyY2VzIjpbIm5nOi8vYW5ndWxhci1jaXJjbGUtY291bnRlci9zcmMvYXBwL2NvdW50ZXIvY291bnRlci5jb21wb25lbnQudHMiLCJuZzovL2FuZ3VsYXItY2lyY2xlLWNvdW50ZXIvc3JjL2FwcC9jb3VudGVyL2NvdW50ZXIubW9kdWxlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIEhvc3RMaXN0ZW5lciwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCAqIGFzIGVhc2UgZnJvbSAnZWFzZS1jb21wb25lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FwcC1jb3VudGVyJyxcbiAgICB0ZW1wbGF0ZTogYDxkaXYgY2xhc3M9XCJuZy1jb3VudGVyXCIgW3N0eWxlLmZvbnQtc2l6ZV09XCJmb250U2l6ZSArICdweCdcIiBbbmdDbGFzc109XCJ7J25nLWNvdW50ZXItLXdpdGgtY2lyY2xlJyA6IHNob3dDaXJjbGV9XCI+XG4gICAgPGRpdiBjbGFzcz1cIm5nLWNvdW50ZXJfX3RleHRcIj5cbiAgICAgICAgPG5nLXRlbXBsYXRlIFtuZ0lmXT1cIiFmaW5pc2hlZENvdW50aW5nIHx8ICFmaW5pc2hlZFRleHQubGVuZ3RoXCI+XG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm5nLWNvdW50ZXJfX3ByZWZpeFwiPlxuICAgICAgICAgICAgICAgIDxuZy1jb250ZW50IHNlbGVjdD1cIm5nLWNvdW50ZXItcHJlZml4XCI+PC9uZy1jb250ZW50PlxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJuZy1jb3VudGVyX19udW1iZXJcIj57e2NvdW50fX08L3NwYW4+XG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm5nLWNvdW50ZXJfX3N1ZmZpeFwiPlxuICAgICAgICAgICAgICAgIDxuZy1jb250ZW50IHNlbGVjdD1cIm5nLWNvdW50ZXItc3VmZml4XCI+PC9uZy1jb250ZW50PlxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICA8L25nLXRlbXBsYXRlPlxuICAgICAgICA8bmctdGVtcGxhdGUgW25nSWZdPVwiZmluaXNoZWRDb3VudGluZyAmJiBmaW5pc2hlZFRleHQubGVuZ3RoXCI+XG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm5nLWNvdW50ZXJfX2ZpbmlzaF90ZXh0XCI+e3tmaW5pc2hlZFRleHR9fTwvc3Bhbj5cbiAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwibmctY291bnRlcl9fY2lyY2xlXCIgKm5nSWY9XCJzaG93Q2lyY2xlXCIgW25nU3R5bGVdPVwiZ2V0Q2lyY2xlU3R5bGUoKVwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwibmctY291bnRlcl9fY2lyY2xlX19iYXJcIiBbbmdTdHlsZV09XCJnZXRCYXJTdHlsZSgpXCI+PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJuZy1jb3VudGVyX19jaXJjbGVfX2ZpbGxcIiBbbmdTdHlsZV09XCJnZXRGaWxsU3R5bGUoKVwiPjwvZGl2PlxuICAgIDwvZGl2PlxuPC9kaXY+YCxcbiAgICBzdHlsZXM6IFtgLm5nLWNvdW50ZXJ7ZGlzcGxheTppbmxpbmUtYmxvY2s7cG9zaXRpb246cmVsYXRpdmU7Zm9udC1zaXplOjE1MHB4fS5uZy1jb3VudGVyLm5nLWNvdW50ZXItLXdpdGgtY2lyY2xle3dpZHRoOjFlbTtoZWlnaHQ6MWVtO2JveC1zaXppbmc6Y29udGVudC1ib3h9Lm5nLWNvdW50ZXIubmctY291bnRlci0td2l0aC1jaXJjbGUgLm5nLWNvdW50ZXJfX3RleHR7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpjZW50ZXI7aGVpZ2h0OjFlbX0ubmctY291bnRlcl9fdGV4dHtkaXNwbGF5OmZsZXh9Lm5nLWNvdW50ZXJfX2ZpbmlzaF90ZXh0LC5uZy1jb3VudGVyX19udW1iZXIsLm5nLWNvdW50ZXJfX3ByZWZpeCwubmctY291bnRlcl9fc3VmZml4e2ZvbnQtc2l6ZTouM2VtfS5uZy1jb3VudGVyX19jaXJjbGV7cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7bGVmdDowO3dpZHRoOjFlbTtoZWlnaHQ6MWVtO2JveC1zaXppbmc6Y29udGVudC1ib3h9Lm5nLWNvdW50ZXJfX2NpcmNsZV9fYmFyLC5uZy1jb3VudGVyX19jaXJjbGVfX2ZpbGx7cG9zaXRpb246YWJzb2x1dGU7Ym9yZGVyOi4wOGVtIHNvbGlkO3dpZHRoOi44NGVtO2hlaWdodDouODRlbTtjbGlwOnJlY3QoMCwuNWVtLDFlbSwwKTtib3JkZXItcmFkaXVzOjUwJTtib3gtc2l6aW5nOmNvbnRlbnQtYm94fWBdLFxufSlcbmV4cG9ydCBjbGFzcyBDb3VudGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgICBASW5wdXQoKSBtb2RlOiBzdHJpbmcgPSAnb25Jbml0JztcbiAgICBASW5wdXQoKSBmcm9tOiBudW1iZXIgPSAwO1xuICAgIEBJbnB1dCgpIHRvOiBudW1iZXIgPSAwO1xuICAgIEBJbnB1dCgpIG9mOiBudW1iZXI7XG4gICAgQElucHV0KCkgYW5pbWF0aW9uVGltZTogbnVtYmVyID0gNDAwMDtcbiAgICBASW5wdXQoKSBhbmltYXRpb25UeXBlOiBzdHJpbmcgPSAnbGluZWFyJztcbiAgICBASW5wdXQoKSBzaG93Q2lyY2xlOiBib29sZWFuID0gdHJ1ZTtcbiAgICBASW5wdXQoKSBjaXJjbGVDb2xvcjogc3RyaW5nID0gJyMzMDdiYmInO1xuICAgIEBJbnB1dCgpIGZvbnRTaXplOiBudW1iZXIgPSAxNTA7XG4gICAgQElucHV0KCkgZGVsYXk6IG51bWJlciA9IDA7XG4gICAgQElucHV0KCkgZmluaXNoZWRUZXh0OiBzdHJpbmcgPSAnJztcbiAgICBAT3V0cHV0KCkgZmluaXNoZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgcHJpdmF0ZSBfaG9sZDogYm9vbGVhbiA9IHRydWU7XG4gICAgcHJpdmF0ZSBfY291bnQ6IG51bWJlcjtcbiAgICBwcml2YXRlIF9zdGFydFRpbWU6IG51bWJlcjtcbiAgICBwcml2YXRlIF9wZXJjZW50RG9uZTogbnVtYmVyID0gMDtcbiAgICBwcml2YXRlIF9ob2xkUHJvZ3Jlc3M6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBfbmF0aXZlRWxlbWVudDogSFRNTEVsZW1lbnQ7XG4gICAgcHJpdmF0ZSBfc3RhcnRUaW1lb3V0O1xuICAgIHByaXZhdGUgX2ZpbmlzaGVkQ291bnRpbmc6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBASG9zdExpc3RlbmVyKCd3aW5kb3c6c2Nyb2xsJywgWyckZXZlbnQnXSlcbiAgICBASG9zdExpc3RlbmVyKCd3aW5kb3c6cmVzaXplJywgWyckZXZlbnQnXSlcbiAgICBvbldpbmRvd0NoYW5nZSgkZXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMubW9kZSAhPT0gJ3ZpZXdwb3J0Jykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmhvbGQgJiYgdGhpcy5pc0VsZW1lbnRJblZpZXdwb3J0KCkpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaG9zdEVsZW1lbnQ6IEVsZW1lbnRSZWYpIHtcbiAgICAgICAgdGhpcy5uYXRpdmVFbGVtZW50ID0gaG9zdEVsZW1lbnQubmF0aXZlRWxlbWVudCBhcyBIVE1MRWxlbWVudDtcbiAgICB9XG5cbiAgICBnZXQgc3RhcnRUaW1lb3V0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3RhcnRUaW1lb3V0O1xuICAgIH1cblxuICAgIHNldCBzdGFydFRpbWVvdXQodmFsdWUpIHtcbiAgICAgICAgdGhpcy5fc3RhcnRUaW1lb3V0ID0gdmFsdWU7XG4gICAgfVxuXG4gICAgZ2V0IG5hdGl2ZUVsZW1lbnQoKTogSFRNTEVsZW1lbnQge1xuICAgICAgICByZXR1cm4gdGhpcy5fbmF0aXZlRWxlbWVudDtcbiAgICB9XG5cbiAgICBzZXQgbmF0aXZlRWxlbWVudCh2YWx1ZTogSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5fbmF0aXZlRWxlbWVudCA9IHZhbHVlO1xuICAgIH1cblxuICAgIGdldCBob2xkUHJvZ3Jlc3MoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hvbGRQcm9ncmVzcztcbiAgICB9XG5cbiAgICBzZXQgaG9sZFByb2dyZXNzKHZhbHVlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5faG9sZFByb2dyZXNzID0gdmFsdWU7XG4gICAgfVxuXG4gICAgZ2V0IHBlcmNlbnREb25lKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wZXJjZW50RG9uZTtcbiAgICB9XG5cbiAgICBzZXQgcGVyY2VudERvbmUodmFsdWU6IG51bWJlcikge1xuICAgICAgICB0aGlzLl9wZXJjZW50RG9uZSA9IHZhbHVlO1xuICAgIH1cblxuICAgIGdldCBjb3VudCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fY291bnQ7XG4gICAgfVxuXG4gICAgc2V0IGNvdW50KHZhbHVlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5fY291bnQgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXQgc3RhcnRUaW1lKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zdGFydFRpbWU7XG4gICAgfVxuXG4gICAgc2V0IHN0YXJ0VGltZSh2YWx1ZTogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuX3N0YXJ0VGltZSA9IHZhbHVlO1xuICAgIH1cblxuICAgIGdldCBob2xkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5faG9sZDtcbiAgICB9XG5cbiAgICBzZXQgaG9sZCh2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICB0aGlzLl9ob2xkID0gdmFsdWU7XG4gICAgfVxuXG4gICAgZ2V0IGZpbmlzaGVkQ291bnRpbmcoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9maW5pc2hlZENvdW50aW5nO1xuICAgIH1cblxuICAgIHNldCBmaW5pc2hlZENvdW50aW5nKHZhbHVlOiBib29sZWFuKSB7XG4gICAgICAgIHRoaXMuX2ZpbmlzaGVkQ291bnRpbmcgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgfVxuXG4gICAgc3RhcnQoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmRlbGF5ID4gMCkge1xuICAgICAgICAgICAgdGhpcy5zdGFydFRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydEFjdGlvbigpO1xuICAgICAgICAgICAgfSwgdGhpcy5kZWxheSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdGFydEFjdGlvbigpO1xuICAgIH1cblxuICAgIHN0b3AoKTogdm9pZCB7XG4gICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy5zdGFydFRpbWVvdXQpO1xuICAgICAgICB0aGlzLmhvbGQgPSB0cnVlO1xuICAgIH1cblxuICAgIHJlc3RhcnQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH1cblxuICAgIGluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuaG9sZCA9IHRydWU7XG4gICAgICAgIHRoaXMuY291bnQgPSB0aGlzLmZyb207XG4gICAgICAgIHRoaXMuaG9sZFByb2dyZXNzID0gMDtcbiAgICAgICAgdGhpcy5zdGFydFRpbWUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucGVyY2VudERvbmUgPSAwO1xuICAgICAgICB0aGlzLmZpbmlzaGVkQ291bnRpbmcgPSBmYWxzZTtcbiAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aGlzLnN0YXJ0VGltZW91dCk7XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5vZiA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMub2YgPSB0aGlzLnRvO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm1vZGUgPT09ICdvbkluaXQnKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRDaXJjbGVTdHlsZSgpOiBhbnkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgJ2NsaXAnOiB0aGlzLnBlcmNlbnREb25lID49IDAuNSA/ICdyZWN0KGF1dG8sIGF1dG8sIGF1dG8sIGF1dG8pJyA6ICdyZWN0KDBlbSwgMWVtLCAxZW0sIDAuNWVtKSdcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBnZXRCYXJTdHlsZSgpOiBhbnkge1xuICAgICAgICBjb25zdCByb3RhdGVEZWcgPSAzNjAgKiB0aGlzLnBlcmNlbnREb25lO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgJ3RyYW5zZm9ybSc6IGByb3RhdGUoJHtyb3RhdGVEZWd9ZGVnKWAsXG4gICAgICAgICAgICAnYm9yZGVyLWNvbG9yJzogdGhpcy5jaXJjbGVDb2xvclxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGdldEZpbGxTdHlsZSgpOiBhbnkge1xuICAgICAgICBjb25zdCByb3RhdGVEZWcgPSB0aGlzLnBlcmNlbnREb25lID4gMC41ID8gMTgwIDogMDtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICdkaXNwbGF5JzogdGhpcy5wZXJjZW50RG9uZSA8PSAwLjUgPyAnbm9uZScgOiAnYmxvY2snLFxuICAgICAgICAgICAgJ3RyYW5zZm9ybSc6IGByb3RhdGUoJHtyb3RhdGVEZWd9ZGVnKWAsXG4gICAgICAgICAgICAnYm9yZGVyLWNvbG9yJzogdGhpcy5jaXJjbGVDb2xvclxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RhcnRBY3Rpb24oKTogdm9pZCB7XG4gICAgICAgIHRoaXMuaG9sZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlcXVlc3RGcmFtZSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc3RlcCh0aW1lc3RhbXApOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXJ0VGltZSkge1xuICAgICAgICAgICAgdGhpcy5zdGFydFRpbWUgPSB0aW1lc3RhbXA7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHByb2dyZXNzID0gdGltZXN0YW1wIC0gdGhpcy5zdGFydFRpbWU7XG4gICAgICAgIHByb2dyZXNzICs9IHRoaXMuaG9sZFByb2dyZXNzO1xuICAgICAgICBpZiAodGhpcy5ob2xkKSB7XG4gICAgICAgICAgICB0aGlzLmhvbGRQcm9ncmVzcyA9IHByb2dyZXNzO1xuICAgICAgICAgICAgdGhpcy5zdGFydFRpbWUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZWFzZVZhbHVlID0gZWFzZVt0aGlzLmFuaW1hdGlvblR5cGVdKHByb2dyZXNzIC8gdGhpcy5hbmltYXRpb25UaW1lKTtcbiAgICAgICAgbGV0IGN1cnJlbnRDb3VudCA9IE1hdGgucm91bmQoZWFzZVZhbHVlICogdGhpcy50byk7XG4gICAgICAgIGlmIChjdXJyZW50Q291bnQgPj0gdGhpcy50bykge1xuICAgICAgICAgICAgY3VycmVudENvdW50ID0gdGhpcy50bztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvdW50ID0gY3VycmVudENvdW50O1xuICAgICAgICB0aGlzLnBlcmNlbnREb25lID0gY3VycmVudENvdW50IC8gdGhpcy5vZjtcbiAgICAgICAgaWYgKHByb2dyZXNzIDwgdGhpcy5hbmltYXRpb25UaW1lKSB7XG4gICAgICAgICAgICB0aGlzLnJlcXVlc3RGcmFtZSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIEZpbmlzaGVkXG4gICAgICAgIHRoaXMuZmluaXNoZWRDb3VudGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuZmluaXNoZWQuZW1pdCgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVxdWVzdEZyYW1lKCk6IHZvaWQge1xuICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMuc3RlcC5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzRWxlbWVudEluVmlld3BvcnQoKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICByZWN0LnRvcCA+PSAwICYmXG4gICAgICAgICAgICByZWN0LmJvdHRvbSA8PSAod2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpXG4gICAgICAgICk7XG4gICAgfVxufVxuIiwiaW1wb3J0IHtOZ01vZHVsZSwgQ1VTVE9NX0VMRU1FTlRTX1NDSEVNQX0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0NvdW50ZXJDb21wb25lbnR9IGZyb20gJy4vY291bnRlci5jb21wb25lbnQnO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcblxuQE5nTW9kdWxlKHtcbiAgICBkZWNsYXJhdGlvbnM6IFtcbiAgICAgICAgQ291bnRlckNvbXBvbmVudFxuICAgIF0sXG4gICAgaW1wb3J0czogW1xuICAgICAgICBDb21tb25Nb2R1bGVcbiAgICBdLFxuICAgIHNjaGVtYXM6IFtDVVNUT01fRUxFTUVOVFNfU0NIRU1BXSxcbiAgICBleHBvcnRzOiBbXG4gICAgICAgIENvdW50ZXJDb21wb25lbnRcbiAgICBdXG59KVxuZXhwb3J0IGNsYXNzIENvdW50ZXJNb2R1bGUge1xufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7SUEy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