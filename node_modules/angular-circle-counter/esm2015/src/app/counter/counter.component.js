/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { Component, ElementRef, EventEmitter, HostListener, Input, Output } from '@angular/core';
import * as ease from 'ease-component';
export class CounterComponent {
    /**
     * @param {?} hostElement
     */
    constructor(hostElement) {
        this.hostElement = hostElement;
        this.mode = 'onInit';
        this.from = 0;
        this.to = 0;
        this.animationTime = 4000;
        this.animationType = 'linear';
        this.showCircle = true;
        this.circleColor = '#307bbb';
        this.fontSize = 150;
        this.delay = 0;
        this.finishedText = '';
        this.finished = new EventEmitter();
        this._hold = true;
        this._percentDone = 0;
        this._holdProgress = 0;
        this._finishedCounting = false;
        this.nativeElement = /** @type {?} */ (hostElement.nativeElement);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onWindowChange($event) {
        if (this.mode !== 'viewport') {
            return;
        }
        if (this.hold && this.isElementInViewport()) {
            this.start();
        }
    }
    /**
     * @return {?}
     */
    get startTimeout() {
        return this._startTimeout;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set startTimeout(value) {
        this._startTimeout = value;
    }
    /**
     * @return {?}
     */
    get nativeElement() {
        return this._nativeElement;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set nativeElement(value) {
        this._nativeElement = value;
    }
    /**
     * @return {?}
     */
    get holdProgress() {
        return this._holdProgress;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set holdProgress(value) {
        this._holdProgress = value;
    }
    /**
     * @return {?}
     */
    get percentDone() {
        return this._percentDone;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set percentDone(value) {
        this._percentDone = value;
    }
    /**
     * @return {?}
     */
    get count() {
        return this._count;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set count(value) {
        this._count = value;
    }
    /**
     * @return {?}
     */
    get startTime() {
        return this._startTime;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set startTime(value) {
        this._startTime = value;
    }
    /**
     * @return {?}
     */
    get hold() {
        return this._hold;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set hold(value) {
        this._hold = value;
    }
    /**
     * @return {?}
     */
    get finishedCounting() {
        return this._finishedCounting;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set finishedCounting(value) {
        this._finishedCounting = value;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.init();
    }
    /**
     * @return {?}
     */
    start() {
        if (this.delay > 0) {
            this.startTimeout = window.setTimeout(() => {
                this.startAction();
            }, this.delay);
            return;
        }
        this.startAction();
    }
    /**
     * @return {?}
     */
    stop() {
        window.clearTimeout(this.startTimeout);
        this.hold = true;
    }
    /**
     * @return {?}
     */
    restart() {
        this.init();
    }
    /**
     * @return {?}
     */
    init() {
        this.hold = true;
        this.count = this.from;
        this.holdProgress = 0;
        this.startTime = undefined;
        this.percentDone = 0;
        this.finishedCounting = false;
        window.clearTimeout(this.startTimeout);
        if (typeof this.of === 'undefined') {
            this.of = this.to;
        }
        if (this.mode === 'onInit') {
            this.start();
        }
    }
    /**
     * @return {?}
     */
    getCircleStyle() {
        return {
            'clip': this.percentDone >= 0.5 ? 'rect(auto, auto, auto, auto)' : 'rect(0em, 1em, 1em, 0.5em)'
        };
    }
    /**
     * @return {?}
     */
    getBarStyle() {
        const /** @type {?} */ rotateDeg = 360 * this.percentDone;
        return {
            'transform': `rotate(${rotateDeg}deg)`,
            'border-color': this.circleColor
        };
    }
    /**
     * @return {?}
     */
    getFillStyle() {
        const /** @type {?} */ rotateDeg = this.percentDone > 0.5 ? 180 : 0;
        return {
            'display': this.percentDone <= 0.5 ? 'none' : 'block',
            'transform': `rotate(${rotateDeg}deg)`,
            'border-color': this.circleColor
        };
    }
    /**
     * @return {?}
     */
    startAction() {
        this.hold = false;
        this.requestFrame();
    }
    /**
     * @param {?} timestamp
     * @return {?}
     */
    step(timestamp) {
        if (!this.startTime) {
            this.startTime = timestamp;
        }
        let /** @type {?} */ progress = timestamp - this.startTime;
        progress += this.holdProgress;
        if (this.hold) {
            this.holdProgress = progress;
            this.startTime = undefined;
            return;
        }
        const /** @type {?} */ easeValue = ease[this.animationType](progress / this.animationTime);
        let /** @type {?} */ currentCount = Math.round(easeValue * this.to);
        if (currentCount >= this.to) {
            currentCount = this.to;
        }
        this.count = currentCount;
        this.percentDone = currentCount / this.of;
        if (progress < this.animationTime) {
            this.requestFrame();
            return;
        }
        // Finished
        this.finishedCounting = true;
        this.finished.emit();
    }
    /**
     * @return {?}
     */
    requestFrame() {
        window.requestAnimationFrame(this.step.bind(this));
    }
    /**
     * @return {?}
     */
    isElementInViewport() {
        const /** @type {?} */ rect = this.nativeElement.getBoundingClientRect();
        return (rect.top >= 0 &&
            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight));
    }
}
CounterComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-counter',
                template: `<div class="ng-counter" [style.font-size]="fontSize + 'px'" [ngClass]="{'ng-counter--with-circle' : showCircle}">
    <div class="ng-counter__text">
        <ng-template [ngIf]="!finishedCounting || !finishedText.length">
            <span class="ng-counter__prefix">
                <ng-content select="ng-counter-prefix"></ng-content>
            </span>
            <span class="ng-counter__number">{{count}}</span>
            <span class="ng-counter__suffix">
                <ng-content select="ng-counter-suffix"></ng-content>
            </span>
        </ng-template>
        <ng-template [ngIf]="finishedCounting && finishedText.length">
            <span class="ng-counter__finish_text">{{finishedText}}</span>
        </ng-template>
    </div>
    <div class="ng-counter__circle" *ngIf="showCircle" [ngStyle]="getCircleStyle()">
        <div class="ng-counter__circle__bar" [ngStyle]="getBarStyle()"></div>
        <div class="ng-counter__circle__fill" [ngStyle]="getFillStyle()"></div>
    </div>
</div>`,
                styles: [`.ng-counter{display:inline-block;position:relative;font-size:150px}.ng-counter.ng-counter--with-circle{width:1em;height:1em;box-sizing:content-box}.ng-counter.ng-counter--with-circle .ng-counter__text{align-items:center;justify-content:center;height:1em}.ng-counter__text{display:flex}.ng-counter__finish_text,.ng-counter__number,.ng-counter__prefix,.ng-counter__suffix{font-size:.3em}.ng-counter__circle{position:absolute;top:0;left:0;width:1em;height:1em;box-sizing:content-box}.ng-counter__circle__bar,.ng-counter__circle__fill{position:absolute;border:.08em solid;width:.84em;height:.84em;clip:rect(0,.5em,1em,0);border-radius:50%;box-sizing:content-box}`],
            },] },
];
/** @nocollapse */
CounterComponent.ctorParameters = () => [
    { type: ElementRef, },
];
CounterComponent.propDecorators = {
    "mode": [{ type: Input },],
    "from": [{ type: Input },],
    "to": [{ type: Input },],
    "of": [{ type: Input },],
    "animationTime": [{ type: Input },],
    "animationType": [{ type: Input },],
    "showCircle": [{ type: Input },],
    "circleColor": [{ type: Input },],
    "fontSize": [{ type: Input },],
    "delay": [{ type: Input },],
    "finishedText": [{ type: Input },],
    "finished": [{ type: Output },],
    "onWindowChange": [{ type: HostListener, args: ['window:scroll', ['$event'],] }, { type: HostListener, args: ['window:resize', ['$event'],] },],
};
function CounterComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    CounterComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    CounterComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    CounterComponent.propDecorators;
    /** @type {?} */
    CounterComponent.prototype.mode;
    /** @type {?} */
    CounterComponent.prototype.from;
    /** @type {?} */
    CounterComponent.prototype.to;
    /** @type {?} */
    CounterComponent.prototype.of;
    /** @type {?} */
    CounterComponent.prototype.animationTime;
    /** @type {?} */
    CounterComponent.prototype.animationType;
    /** @type {?} */
    CounterComponent.prototype.showCircle;
    /** @type {?} */
    CounterComponent.prototype.circleColor;
    /** @type {?} */
    CounterComponent.prototype.fontSize;
    /** @type {?} */
    CounterComponent.prototype.delay;
    /** @type {?} */
    CounterComponent.prototype.finishedText;
    /** @type {?} */
    CounterComponent.prototype.finished;
    /** @type {?} */
    CounterComponent.prototype._hold;
    /** @type {?} */
    CounterComponent.prototype._count;
    /** @type {?} */
    CounterComponent.prototype._startTime;
    /** @type {?} */
    CounterComponent.prototype._percentDone;
    /** @type {?} */
    CounterComponent.prototype._holdProgress;
    /** @type {?} */
    CounterComponent.prototype._nativeElement;
    /** @type {?} */
    CounterComponent.prototype._startTimeout;
    /** @type {?} */
    CounterComponent.prototype._finishedCounting;
    /** @type {?} */
    CounterComponent.prototype.hostElement;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY291bnRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLWNpcmNsZS1jb3VudGVyLyIsInNvdXJjZXMiOlsic3JjL2FwcC9jb3VudGVyL2NvdW50ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDdkcsT0FBTyxLQUFLLElBQUksTUFBTSxnQkFBZ0IsQ0FBQztBQTBCdkMsTUFBTTs7OztJQWdDRixZQUFvQixXQUF1QjtRQUF2QixnQkFBVyxHQUFYLFdBQVcsQ0FBWTtvQkEvQm5CLFFBQVE7b0JBQ1IsQ0FBQztrQkFDSCxDQUFDOzZCQUVVLElBQUk7NkJBQ0osUUFBUTswQkFDVixJQUFJOzJCQUNKLFNBQVM7d0JBQ1osR0FBRztxQkFDTixDQUFDOzRCQUNNLEVBQUU7d0JBQ2IsSUFBSSxZQUFZLEVBQUU7cUJBQ2QsSUFBSTs0QkFHRSxDQUFDOzZCQUNBLENBQUM7aUNBR0ksS0FBSztRQWF0QyxJQUFJLENBQUMsYUFBYSxxQkFBRyxXQUFXLENBQUMsYUFBNEIsQ0FBQSxDQUFDO0tBQ2pFOzs7OztJQVhELGNBQWMsQ0FBQyxNQUFNO1FBQ2pCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQztZQUMzQixNQUFNLENBQUM7U0FDVjtRQUNELEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUNoQjs7Ozs7SUFPTCxJQUFJLFlBQVk7UUFDWixNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQztLQUM3Qjs7Ozs7SUFFRCxJQUFJLFlBQVksQ0FBQyxLQUFLO1FB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SSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUN4RCxNQUFNLENBQUMsQ0FDSCxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUM7WUFDYixJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsSUFBSSxRQUFRLENBQUMsZUFBZSxDQUFDLFlBQVksQ0FBQyxDQUMvRSxDQUFDOzs7O1lBbk9ULFNBQVMsU0FBQztnQkFDUCxRQUFRLEVBQUUsYUFBYTtnQkFDdkIsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O09BbUJQO2dCQUNILE1BQU0sRUFBRSxDQUFDLG9wQkFBb3BCLENBQUM7YUFDanFCOzs7O1lBMUJrQixVQUFVOzs7cUJBNEJ4QixLQUFLO3FCQUNMLEtBQUs7bUJBQ0wsS0FBSzttQkFDTCxLQUFLOzhCQUNMLEtBQUs7OEJBQ0wsS0FBSzsyQkFDTCxLQUFLOzRCQUNMLEtBQUs7eUJBQ0wsS0FBSztzQkFDTCxLQUFLOzZCQUNMLEtBQUs7eUJBQ0wsTUFBTTsrQkFTTixZQUFZLFNBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDLGNBQ3hDLFlBQVksU0FBQyxlQUFlLEVBQUUsQ0FBQyxRQUFRLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBIb3N0TGlzdGVuZXIsIElucHV0LCBPbkluaXQsIE91dHB1dH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgKiBhcyBlYXNlIGZyb20gJ2Vhc2UtY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdhcHAtY291bnRlcicsXG4gICAgdGVtcGxhdGU6IGA8ZGl2IGNsYXNzPVwibmctY291bnRlclwiIFtzdHlsZS5mb250LXNpemVdPVwiZm9udFNpemUgKyAncHgnXCIgW25nQ2xhc3NdPVwieyduZy1jb3VudGVyLS13aXRoLWNpcmNsZScgOiBzaG93Q2lyY2xlfVwiPlxuICAgIDxkaXYgY2xhc3M9XCJuZy1jb3VudGVyX190ZXh0XCI+XG4gICAgICAgIDxuZy10ZW1wbGF0ZSBbbmdJZl09XCIhZmluaXNoZWRDb3VudGluZyB8fCAhZmluaXNoZWRUZXh0Lmxlbmd0aFwiPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJuZy1jb3VudGVyX19wcmVmaXhcIj5cbiAgICAgICAgICAgICAgICA8bmctY29udGVudCBzZWxlY3Q9XCJuZy1jb3VudGVyLXByZWZpeFwiPjwvbmctY29udGVudD5cbiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibmctY291bnRlcl9fbnVtYmVyXCI+e3tjb3VudH19PC9zcGFuPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJuZy1jb3VudGVyX19zdWZmaXhcIj5cbiAgICAgICAgICAgICAgICA8bmctY29udGVudCBzZWxlY3Q9XCJuZy1jb3VudGVyLXN1ZmZpeFwiPjwvbmctY29udGVudD5cbiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgPG5nLXRlbXBsYXRlIFtuZ0lmXT1cImZpbmlzaGVkQ291bnRpbmcgJiYgZmluaXNoZWRUZXh0Lmxlbmd0aFwiPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJuZy1jb3VudGVyX19maW5pc2hfdGV4dFwiPnt7ZmluaXNoZWRUZXh0fX08L3NwYW4+XG4gICAgICAgIDwvbmctdGVtcGxhdGU+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cIm5nLWNvdW50ZXJfX2NpcmNsZVwiICpuZ0lmPVwic2hvd0NpcmNsZVwiIFtuZ1N0eWxlXT1cImdldENpcmNsZVN0eWxlKClcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cIm5nLWNvdW50ZXJfX2NpcmNsZV9fYmFyXCIgW25nU3R5bGVdPVwiZ2V0QmFyU3R5bGUoKVwiPjwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwibmctY291bnRlcl9fY2lyY2xlX19maWxsXCIgW25nU3R5bGVdPVwiZ2V0RmlsbFN0eWxlKClcIj48L2Rpdj5cbiAgICA8L2Rpdj5cbjwvZGl2PmAsXG4gICAgc3R5bGVzOiBbYC5uZy1jb3VudGVye2Rpc3BsYXk6aW5saW5lLWJsb2NrO3Bvc2l0aW9uOnJlbGF0aXZlO2ZvbnQtc2l6ZToxNTBweH0ubmctY291bnRlci5uZy1jb3VudGVyLS13aXRoLWNpcmNsZXt3aWR0aDoxZW07aGVpZ2h0OjFlbTtib3gtc2l6aW5nOmNvbnRlbnQtYm94fS5uZy1jb3VudGVyLm5nLWNvdW50ZXItLXdpdGgtY2lyY2xlIC5uZy1jb3VudGVyX190ZXh0e2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2hlaWdodDoxZW19Lm5nLWNvdW50ZXJfX3RleHR7ZGlzcGxheTpmbGV4fS5uZy1jb3VudGVyX19maW5pc2hfdGV4dCwubmctY291bnRlcl9fbnVtYmVyLC5uZy1jb3VudGVyX19wcmVmaXgsLm5nLWNvdW50ZXJfX3N1ZmZpeHtmb250LXNpemU6LjNlbX0ubmctY291bnRlcl9fY2lyY2xle3Bvc2l0aW9uOmFic29sdXRlO3RvcDowO2xlZnQ6MDt3aWR0aDoxZW07aGVpZ2h0OjFlbTtib3gtc2l6aW5nOmNvbnRlbnQtYm94fS5uZy1jb3VudGVyX19jaXJjbGVfX2JhciwubmctY291bnRlcl9fY2lyY2xlX19maWxse3Bvc2l0aW9uOmFic29sdXRlO2JvcmRlcjouMDhlbSBzb2xpZDt3aWR0aDouODRlbTtoZWlnaHQ6Ljg0ZW07Y2xpcDpyZWN0KDAsLjVlbSwxZW0sMCk7Ym9yZGVyLXJhZGl1czo1MCU7Ym94LXNpemluZzpjb250ZW50LWJveH1gXSxcbn0pXG5leHBvcnQgY2xhc3MgQ291bnRlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gICAgQElucHV0KCkgbW9kZTogc3RyaW5nID0gJ29uSW5pdCc7XG4gICAgQElucHV0KCkgZnJvbTogbnVtYmVyID0gMDtcbiAgICBASW5wdXQoKSB0bzogbnVtYmVyID0gMDtcbiAgICBASW5wdXQoKSBvZjogbnVtYmVyO1xuICAgIEBJbnB1dCgpIGFuaW1hdGlvblRpbWU6IG51bWJlciA9IDQwMDA7XG4gICAgQElucHV0KCkgYW5pbWF0aW9uVHlwZTogc3RyaW5nID0gJ2xpbmVhcic7XG4gICAgQElucHV0KCkgc2hvd0NpcmNsZTogYm9vbGVhbiA9IHRydWU7XG4gICAgQElucHV0KCkgY2lyY2xlQ29sb3I6IHN0cmluZyA9ICcjMzA3YmJiJztcbiAgICBASW5wdXQoKSBmb250U2l6ZTogbnVtYmVyID0gMTUwO1xuICAgIEBJbnB1dCgpIGRlbGF5OiBudW1iZXIgPSAwO1xuICAgIEBJbnB1dCgpIGZpbmlzaGVkVGV4dDogc3RyaW5nID0gJyc7XG4gICAgQE91dHB1dCgpIGZpbmlzaGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIHByaXZhdGUgX2hvbGQ6IGJvb2xlYW4gPSB0cnVlO1xuICAgIHByaXZhdGUgX2NvdW50OiBudW1iZXI7XG4gICAgcHJpdmF0ZSBfc3RhcnRUaW1lOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBfcGVyY2VudERvbmU6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBfaG9sZFByb2dyZXNzOiBudW1iZXIgPSAwO1xuICAgIHByaXZhdGUgX25hdGl2ZUVsZW1lbnQ6IEhUTUxFbGVtZW50O1xuICAgIHByaXZhdGUgX3N0YXJ0VGltZW91dDtcbiAgICBwcml2YXRlIF9maW5pc2hlZENvdW50aW5nOiBib29sZWFuID0gZmFsc2U7XG4gICAgQEhvc3RMaXN0ZW5lcignd2luZG93OnNjcm9sbCcsIFsnJGV2ZW50J10pXG4gICAgQEhvc3RMaXN0ZW5lcignd2luZG93OnJlc2l6ZScsIFsnJGV2ZW50J10pXG4gICAgb25XaW5kb3dDaGFuZ2UoJGV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLm1vZGUgIT09ICd2aWV3cG9ydCcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5ob2xkICYmIHRoaXMuaXNFbGVtZW50SW5WaWV3cG9ydCgpKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGhvc3RFbGVtZW50OiBFbGVtZW50UmVmKSB7XG4gICAgICAgIHRoaXMubmF0aXZlRWxlbWVudCA9IGhvc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgfVxuXG4gICAgZ2V0IHN0YXJ0VGltZW91dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0VGltZW91dDtcbiAgICB9XG5cbiAgICBzZXQgc3RhcnRUaW1lb3V0KHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3N0YXJ0VGltZW91dCA9IHZhbHVlO1xuICAgIH1cblxuICAgIGdldCBuYXRpdmVFbGVtZW50KCk6IEhUTUxFbGVtZW50IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX25hdGl2ZUVsZW1lbnQ7XG4gICAgfVxuXG4gICAgc2V0IG5hdGl2ZUVsZW1lbnQodmFsdWU6IEhUTUxFbGVtZW50KSB7XG4gICAgICAgIHRoaXMuX25hdGl2ZUVsZW1lbnQgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXQgaG9sZFByb2dyZXNzKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ob2xkUHJvZ3Jlc3M7XG4gICAgfVxuXG4gICAgc2V0IGhvbGRQcm9ncmVzcyh2YWx1ZTogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuX2hvbGRQcm9ncmVzcyA9IHZhbHVlO1xuICAgIH1cblxuICAgIGdldCBwZXJjZW50RG9uZSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fcGVyY2VudERvbmU7XG4gICAgfVxuXG4gICAgc2V0IHBlcmNlbnREb25lKHZhbHVlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5fcGVyY2VudERvbmUgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXQgY291bnQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvdW50O1xuICAgIH1cblxuICAgIHNldCBjb3VudCh2YWx1ZTogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuX2NvdW50ID0gdmFsdWU7XG4gICAgfVxuXG4gICAgZ2V0IHN0YXJ0VGltZSgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3RhcnRUaW1lO1xuICAgIH1cblxuICAgIHNldCBzdGFydFRpbWUodmFsdWU6IG51bWJlcikge1xuICAgICAgICB0aGlzLl9zdGFydFRpbWUgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXQgaG9sZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hvbGQ7XG4gICAgfVxuXG4gICAgc2V0IGhvbGQodmFsdWU6IGJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5faG9sZCA9IHZhbHVlO1xuICAgIH1cblxuICAgIGdldCBmaW5pc2hlZENvdW50aW5nKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fZmluaXNoZWRDb3VudGluZztcbiAgICB9XG5cbiAgICBzZXQgZmluaXNoZWRDb3VudGluZyh2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICB0aGlzLl9maW5pc2hlZENvdW50aW5nID0gdmFsdWU7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH1cblxuICAgIHN0YXJ0KCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5kZWxheSA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRUaW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRBY3Rpb24oKTtcbiAgICAgICAgICAgIH0sIHRoaXMuZGVsYXkpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3RhcnRBY3Rpb24oKTtcbiAgICB9XG5cbiAgICBzdG9wKCk6IHZvaWQge1xuICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMuc3RhcnRUaW1lb3V0KTtcbiAgICAgICAgdGhpcy5ob2xkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXN0YXJ0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICB9XG5cbiAgICBpbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmhvbGQgPSB0cnVlO1xuICAgICAgICB0aGlzLmNvdW50ID0gdGhpcy5mcm9tO1xuICAgICAgICB0aGlzLmhvbGRQcm9ncmVzcyA9IDA7XG4gICAgICAgIHRoaXMuc3RhcnRUaW1lID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBlcmNlbnREb25lID0gMDtcbiAgICAgICAgdGhpcy5maW5pc2hlZENvdW50aW5nID0gZmFsc2U7XG4gICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy5zdGFydFRpbWVvdXQpO1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMub2YgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLm9mID0gdGhpcy50bztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5tb2RlID09PSAnb25Jbml0Jykge1xuICAgICAgICAgICAgdGhpcy5zdGFydCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0Q2lyY2xlU3R5bGUoKTogYW55IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICdjbGlwJzogdGhpcy5wZXJjZW50RG9uZSA+PSAwLjUgPyAncmVjdChhdXRvLCBhdXRvLCBhdXRvLCBhdXRvKScgOiAncmVjdCgwZW0sIDFlbSwgMWVtLCAwLjVlbSknXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZ2V0QmFyU3R5bGUoKTogYW55IHtcbiAgICAgICAgY29uc3Qgcm90YXRlRGVnID0gMzYwICogdGhpcy5wZXJjZW50RG9uZTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICd0cmFuc2Zvcm0nOiBgcm90YXRlKCR7cm90YXRlRGVnfWRlZylgLFxuICAgICAgICAgICAgJ2JvcmRlci1jb2xvcic6IHRoaXMuY2lyY2xlQ29sb3JcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBnZXRGaWxsU3R5bGUoKTogYW55IHtcbiAgICAgICAgY29uc3Qgcm90YXRlRGVnID0gdGhpcy5wZXJjZW50RG9uZSA+IDAuNSA/IDE4MCA6IDA7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAnZGlzcGxheSc6IHRoaXMucGVyY2VudERvbmUgPD0gMC41ID8gJ25vbmUnIDogJ2Jsb2NrJyxcbiAgICAgICAgICAgICd0cmFuc2Zvcm0nOiBgcm90YXRlKCR7cm90YXRlRGVnfWRlZylgLFxuICAgICAgICAgICAgJ2JvcmRlci1jb2xvcic6IHRoaXMuY2lyY2xlQ29sb3JcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXJ0QWN0aW9uKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmhvbGQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZXF1ZXN0RnJhbWUoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0ZXAodGltZXN0YW1wKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5zdGFydFRpbWUpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRUaW1lID0gdGltZXN0YW1wO1xuICAgICAgICB9XG4gICAgICAgIGxldCBwcm9ncmVzcyA9IHRpbWVzdGFtcCAtIHRoaXMuc3RhcnRUaW1lO1xuICAgICAgICBwcm9ncmVzcyArPSB0aGlzLmhvbGRQcm9ncmVzcztcbiAgICAgICAgaWYgKHRoaXMuaG9sZCkge1xuICAgICAgICAgICAgdGhpcy5ob2xkUHJvZ3Jlc3MgPSBwcm9ncmVzcztcbiAgICAgICAgICAgIHRoaXMuc3RhcnRUaW1lID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGVhc2VWYWx1ZSA9IGVhc2VbdGhpcy5hbmltYXRpb25UeXBlXShwcm9ncmVzcyAvIHRoaXMuYW5pbWF0aW9uVGltZSk7XG4gICAgICAgIGxldCBjdXJyZW50Q291bnQgPSBNYXRoLnJvdW5kKGVhc2VWYWx1ZSAqIHRoaXMudG8pO1xuICAgICAgICBpZiAoY3VycmVudENvdW50ID49IHRoaXMudG8pIHtcbiAgICAgICAgICAgIGN1cnJlbnRDb3VudCA9IHRoaXMudG87XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb3VudCA9IGN1cnJlbnRDb3VudDtcbiAgICAgICAgdGhpcy5wZXJjZW50RG9uZSA9IGN1cnJlbnRDb3VudCAvIHRoaXMub2Y7XG4gICAgICAgIGlmIChwcm9ncmVzcyA8IHRoaXMuYW5pbWF0aW9uVGltZSkge1xuICAgICAgICAgICAgdGhpcy5yZXF1ZXN0RnJhbWUoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBGaW5pc2hlZFxuICAgICAgICB0aGlzLmZpbmlzaGVkQ291bnRpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLmZpbmlzaGVkLmVtaXQoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHJlcXVlc3RGcmFtZSgpOiB2b2lkIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnN0ZXAuYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc0VsZW1lbnRJblZpZXdwb3J0KCk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCByZWN0ID0gdGhpcy5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgcmVjdC50b3AgPj0gMCAmJlxuICAgICAgICAgICAgcmVjdC5ib3R0b20gPD0gKHdpbmRvdy5pbm5lckhlaWdodCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0KVxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==